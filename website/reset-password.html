<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Reset Password - CommUnity" />
    <title>Reset Password - CommUnity</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" type="image/png" href="../assets/images/favicon.png" />
  </head>
  <body>
    <nav class="navbar">
      <div class="container">
        <div class="nav-content">
          <a href="index.html" class="logo">
            <span class="logo-icon">ðŸ‘¥</span>
            <span class="logo-text">CommUnity</span>
          </a>
          <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="privacy-policy.html">Privacy</a></li>
            <li><a href="terms-of-service.html">Terms</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-icon">ðŸ”’</div>
        <h1>Reset Password</h1>
        <p>
          Please enter your new password below. This link will expire after use.
        </p>

        <div id="form-container">
          <form id="reset-form" class="contact-form">
            <div class="form-group">
              <label for="password">New Password</label>
              <input
                type="password"
                id="password"
                name="password"
                required
                minlength="6"
                placeholder="Enter new password"
              />
            </div>
            <div class="form-group">
              <label for="confirm-password">Confirm Password</label>
              <input
                type="password"
                id="confirm-password"
                name="confirm-password"
                required
                minlength="6"
                placeholder="Confirm new password"
              />
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%">
              Reset Password
            </button>
          </form>
        </div>

        <div id="success-message" style="display: none">
          <p class="status-success" style="margin-top: 20px">
            Your password has been reset successfully!
          </p>
          <p style="margin-top: 10px">
            You can now close this page and return to the app to sign in with
            your new password.
          </p>
          <a
            href="myapp://reset-password"
            class="btn btn-primary"
            style="margin-top: 20px; width: 100%"
            >Open App</a
          >
        </div>

        <div id="error-message" style="display: none">
          <p class="status-error" style="margin-top: 20px" id="error-text"></p>
          <a
            href="myapp://sign-in"
            class="btn btn-secondary"
            style="margin-top: 20px; width: 100%"
            >Return to App</a
          >
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>CommUnity</h3>
            <p>Connecting communities through real-time information sharing.</p>
          </div>
          <div class="footer-section">
            <h4>Legal</h4>
            <ul>
              <li><a href="privacy-policy.html">Privacy Policy</a></li>
              <li><a href="terms-of-service.html">Terms of Service</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h4>Support</h4>
            <ul>
              <li><a href="contact.html">Contact Us</a></li>
              <li>
                <a href="mailto:support@communityuo.com"
                  >support@communityuo.com</a
                >
              </li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2024 CommUnity. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script>
      // Check if we have valid tokens from Supabase
      const urlParams = new URLSearchParams(window.location.search);
      const hash = window.location.hash.substring(1);
      const hashParams = new URLSearchParams(hash);

      const accessToken =
        urlParams.get('access_token') || hashParams.get('access_token');
      const type = urlParams.get('type') || hashParams.get('type');

      if (!accessToken || type !== 'recovery') {
        // No valid token, show error
        document.getElementById('form-container').style.display = 'none';
        document.getElementById('error-message').style.display = 'block';
        document.getElementById('error-text').textContent =
          'Invalid or expired password reset link. Please request a new password reset from the app.';
      }

      // Handle form submission
      document
        .getElementById('reset-form')
        .addEventListener('submit', async function (e) {
          e.preventDefault();

          const password = document.getElementById('password').value;
          const confirmPassword =
            document.getElementById('confirm-password').value;

          // Validate passwords
          if (password.length < 6) {
            alert('Password must be at least 6 characters long.');
            return;
          }

          if (password !== confirmPassword) {
            alert('Passwords do not match. Please try again.');
            return;
          }

          // Note: In a real implementation, you would need to call Supabase API
          // to update the password using the access token. Since this is a static website,
          // we'll redirect to the app with instructions.

          // For now, show success and redirect to app
          // The app will handle the actual password reset using the token
          document.getElementById('form-container').style.display = 'none';
          document.getElementById('success-message').style.display = 'block';

          // Try to open the app with deep link
          setTimeout(() => {
            window.location.href =
              'myapp://reset-password?token=' +
              encodeURIComponent(accessToken) +
              '&password=' +
              encodeURIComponent(password);
          }, 1000);
        });
    </script>
  </body>
</html>
